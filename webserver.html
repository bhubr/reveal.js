<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Présentations</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/night.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- My own css -->
    <link rel="stylesheet" href="css/extra.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
          <p>Le web, côté serveur</p>
          <p class="fragment"><a href="https://prez.wild31.com/webserver.html" target="_blank">https://prez.wild31.com/webserver.html</a></p>
          <p class="fragment">D'abord, un peu de contexte...</p>
        </section>
				<section>
          <p>
            Une simple page web
            <img src="images/page-html-simple.png" alt="Page HTML simple" class="img1" />
          </p>
          <div class="fragment">
            <span class="highlight-addressbar">
              <span class="fragment"><code>file://</code></span>
              <span class="fragment">indique un fichier chargé depuis le disque</span>
            </span>
          </div>
        </section>
        <section>
          <p class="par1">
            Une page web est en général<br>chargée depuis un serveur.
          </p>
          <img src="images/page-web-serveur.png" alt="Page chargée depuis un serveur" />
          <div class="fragment">
            <span class="highlight-addressbar2">
              <span class="fragment"><code>http://</code></span>
              <span class="fragment">implicite</span>
            </span>
          </div>
        </section>
        <section>
          <p>Le web, comme d'autres usages d'Internet (email, FTP, IRC),
          repose sur le modèle <em>client-serveur</em>.</p>
          <img src="images/Client-server-model.svg" alt="Modèle client-serveur" class="img1" />
        </section>
        <section>
          Les termes de <em>serveur</em> et de <em>client</em> peuvent à la fois désigner le matériel et le logiciel.
        </section>
        <section>
          <div class="flex col-2 servers">
            <div>
              <img src="images/serveur-dell-poweredge-r320-rack-format-1u.jpg" alt="Serveur Rack" class="rack" />
            </div>

            <div class="flex col-2 software-servers">
              <div>web</div>
              <div>email</div>
              <div>FTP</div>
              <div>...</div>
            </div> 
            <div>
              Un serveur matériel<br>héberge...
            </div>
            <div>
              ...un ou des programmes serveurs
            </div>
          </div>
        </section>
        <section>
          <div class="flex col-2 clients">
            <div class="flex client-images">
              <div><img src="images/laptop.png" alt="Laptop" /></div>
              <div><img src="images/smartphone.jpg" alt="Laptop" /></div>
            </div>

            <div class="flex col-2 software-servers">
              <div>web</div>
              <div>email</div>
            </div>
            <div>
              Un client matériel<br>héberge...
            </div>
            <div>
              ...un ou des programmes clients
            </div>
          </div>
        </section>
        <section>
          <p>Communication entre client et serveur</p>
          <ol>
            <li>Le client envoie une requête au serveur</li>
            <li>Le serveur la traite et renvoie une réponse</li>
          </ol>
          <img src="images/request.png" alt="Requête client-serveur" />
          <p class="fragment" style="font-size: 60%">
            Ce sont à la fois les machines et les programmes qui communiquent !
          </p>
        </section>
        <section>
          <p>
            Les échanges entre client et serveur sont régis par un
            <a href="https://fr.wikipedia.org/wiki/Protocole" target="
            _blank">protocole</a>.
          </p>
          <p class="fragment">Un mot inspiré la vie quotidienne.</p>
          <p class="fragment">Exemple d'un café/restaurant : un <em>client</em> est censé formuler sa demande (<em>requête</em>) au <em>serveur</em> d'une manière appropriée.</p>
        </section>
        <section>
          <p>Exemples de protocoles utilisés sur Internet :</p>
          <ul>
            <li class="fragment highlight-blue">HTTP : HyperText Transfer Protocol</li>
            <li>FTP : File Transfer Protocol</li>
            <li>POP : Post Office Protocol</li>
            <li>IMAP : Internet Message Access Protocol</li>
            <li>SMTP : Simple Mail Transfer Protocol</li>
          </ul>
        </section>
        <section>
          <h4>Les <em>ports</em> #1</h4>
          <p>Un programme serveur est un programme "résident" : il fonctionne en permanence.</p>
          <p class="fragment">La plupart du temps, il est en attente de requêtes&nbsp;: il "écoute".</p>
          <p class="fragment">Chaque programme serveur écoute sur un "canal" différent : on appelle ces canaux des <em>ports</em>.</p>
        </section>
        <section>
          <h4>Les <em>ports</em> #2</h4>
          <p>Les ports sont standardisés et <em>numérotés</em></p>
          <ul class="fragment">
            <li>80 : HTTP</li>
            <li>443 : HTTPS (HTTP sécurisé)</li>
            <li>21 : FTP</li>
            <li>110 : POP3</li>
            <li>etc.</li>
          </ul>
        </section>
        <section>
          <h4>Les <em>ports</em> #3</h4>
          <img style="background: #ddd" src="images/ports.png" alt="Illustration ports" />
          <p class="fragment" style="font-size: 90%">Le programme client se connecte au programme serveur en ciblant le port sur lequel ce dernier écoute.</p>
        </section>
        <section>
          <h4>Les <em>ports</em> #4</h4>
          <p>La plupart du temps, on n'a pas besoin de préciser le port : par défaut, le client utilise le port adéquat.</p>
          <ul>
            <li>Les navigateurs choisissent le port 80 (HTTP), 443 (HTTPS), 21 (FTP) intelligemment.</li>
            <li>Les clients de messagerie choisissent le bon port en fonction de la configuration du compte utilisateur (notamment du type de serveur, POP3 ou IMAP).</li>
          </ul>
        </section>
        <section>
          <p>Serveurs HTTP Open Source</p>
          <div class="flex col-2 web-servers">
            <div>
              <a href="http://httpd.apache.org/" target="_blank">
                <img src="images/httpd_logo_wide_new.png" alt="Logo Apache" class="no-border" style="padding: 13px 0" />
              </a>
            </div>
            <div>
              <a href="https://nginx.org/en/" target="_blank">
                <img src="images/logo-nginx.svg" alt="Logo Nginx" class="no-border" style="padding: 10px" />
              </a>
            </div>
          </div>
          <p class="fragment"><br>Si on n'a pas besoin de toutes les fonctionnalités d'un tel serveur, de nombreux langages proposent des <a href="https://gist.github.com/willurd/5720255" target="_blank">serveurs</a> plus légers.</p>
        </section>
        <section>
          <p>Clients HTTP</p>
          <ul>
            <li class="fragment">Les navigateurs</li>
            <li class="fragment"><a href="https://www.getpostman.com/" target="_blank">Postman</a> pour tester des APIs</li>
            <li class="fragment"><code>curl</code> et <code>wget</code> en ligne de commande</li>
            <li class="fragment"><code>httrack</code> pour "aspirer" des sites</li>
            <li class="fragment"><code>telnet</code>, client universel (non spécifique à HTTP)</li>
          </ul>
        </section>
        <section>
          <p>Un peu de pratique, dans le terminal</p>
          <ul class="fragment" style="font-size: 80%">
            <li><code>wget</code> : récupérer <a href="monsite.tar.gz">l'archive</a></li>
            <li><code>tar</code> : décompresser l'archive</li>
          </ul>
          <pre class="fragment" style="margin: 0 auto">
            <code>wget https://prez.wild31.com/monsite.tar.gz
tar xvzf monsite.tar.gz
cd monsite</code>
          </pre>
          <p class="fragment no-margin">Lancer un serveur avec Python</p>
          <pre class="fragment no-margin">
            <code>python3 -m http.server 5000</code>
          </pre>
          <p class="fragment">
            <a href="http://localhost:5000" target="_blank">http://localhost:5000</a>
          </p>
        </section>
        <section>
          On peut consulter le site de différentes façons :
          <ul>
            <li>Via le navigateur</li>
            <li>Avec Postman</li>
            <li>Avec <code>wget</code> : <code class="inline-code">wget http://localhost:5000</code></li>
            <li>Avec <code>telnet</code> : <code class="inline-code">telnet localhost 5000</code></li>
          </ul>
        </section>
        <section>
          <p>Une requête HTTP avec telnet</p>
          <pre><code>wilder@ubuntu:~$ telnet localhost 5000
Trying ::1...
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.</code></pre>
          <div class="fragment">
            <p>Une fois lancé, saisir (valider par Entrée deux fois)</p>
            <pre><code>GET /</code></pre>
          </div>
        </section>
        <section>
          <p>Différence avec un autre protocole<br>Exemple POP3</p>
          <p style="font-size: 75%">1. Installation d'un serveur POP3 factice</p>
          <pre><code>git clone https://github.com/andris9/n3.git
cd n3
npm install
sudo node pop3_server</code></pre>
        </section>
        <section>
          <p>Exemple POP3 - 2. Dialogue avec telnet</p>
          <pre><code>wilder@ubuntu:~$ telnet localhost 110
Trying ::1...
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.</code></pre>
          <div class="fragment">
            <p>Une fois lancé, saisir</p>
            <pre><code>USER anyone
PASS 12345
LIST
RETR 1</code></pre>
          </div>
        </section>
        <section>
          <h4>Retour aux serveurs web</h4>
          <p>Traitement d'une requête</p>
          <ul style="font-size: 80%">
            <li class="fragment">Vérifier si le chemin demandé correspond à un fichier (à partir de la <em>racine des documents</em>), et l'envoyer s'il existe</li>
            <li class="fragment">Sinon, si le chemin correspond à un répertoire<ul>
              <li>envoyer <code>index.html</code> s'il existe dans ce répertoire</li>
              <li>lister le contenu du répertoire sinon</li>
            </ul></li>
            <li class="fragment">Sinon, envoyer une erreur 404</li>
          </ul>
        </section>
        <section>
          <h4>nginx #1 - Installation</h4>
          <pre class="fragment"><code>sudo apt-get install nginx</code></pre>
          <p class="fragment"><a href="http://localhost">http://localhost</a></p>
        </section>
        <section>
          <h4>nginx #2 - Configuration</h4>
          <pre class="fragment">
            <code># Fichier /etc/nginx/sites-enabled/default
server {
  listen 80 default_server;
  listen [::]:80 default_server;

  root /var/www/html;

  # ...
}</code></pre>
          <ul class="fragment" style="font-size: 80%">
            <li><code>listen</code> indique le port</li>
            <li><code>root</code> indique le chemin d'où le serveur lit les fichiers (racine des documents ou <em>document root</em>).</li>
          </ul>
        </section>
        <section>
          <h4>nginx #3 - Créer son propre index</h4>
          <pre class="fragment"><code>sudo nano /var/www/html/index.html</code></pre>
          <p class="fragment">
            Y écrire un contenu HTML basique
            <pre class="fragment"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;It works!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
          </p>
          <p class="fragment">Vérifier : <a href="http://localhost">http://localhost</a></p>
        </section>
        <section>
          <h4>nginx #4 - Fichiers journaux</h4>
          <p>
            Les journaux (<em>logs</em>) permettent au serveur de sauvegarder des informations :
            <ul>
              <li>sur les accès :<br><code class="inline-code">sudo tail -f /var/log/nginx/access.log</code></li>
              <li>sur les erreurs :<br><code class="inline-code">sudo tail -f /var/log/nginx/error.log</code></li>
            </ul>
          </p>
        </section>
        <section><em>That's all, folks!</em></section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
